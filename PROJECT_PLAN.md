# äºŒæ¬¡å…ƒè·¨å¢ƒç”µå•†è¿è¥å·¥ä½œå° - é¡¹ç›®è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°

ä¸ºäºŒæ¬¡å…ƒæ‰‹åŠ/å‘¨è¾¹è·¨å¢ƒç”µå•†å›¢é˜Ÿæ‰“é€ çš„ç¤¾åª’è¿è¥å·¥ä½œå°ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯ç»Ÿä¸€ç®¡ç†å¤šå¹³å°æ¶ˆæ¯ã€AIè¾…åŠ©å†…å®¹ç”Ÿæˆã€å·¥ä½œæµè‡ªåŠ¨åŒ–ã€‚

**æ¶æ„è®¾è®¡ï¼š**
- å‰ç«¯ï¼šNext.js æä¾›è¿è¥ç•Œé¢
- åç«¯é€»è¾‘ï¼šn8n å·¥ä½œæµå¼•æ“ï¼ˆé€šè¿‡ Webhook é€šä¿¡ï¼‰
- æ•°æ®å­˜å‚¨ï¼šSQLiteï¼ˆå¼€å‘ï¼‰/ PostgreSQLï¼ˆç”Ÿäº§ï¼‰

**æ ¸å¿ƒç†å¿µï¼š**
- å‰ç«¯åªè´Ÿè´£å±•ç¤ºå’Œäº¤äº’ï¼Œä¸å†™å¤æ‚ä¸šåŠ¡é€»è¾‘
- æ‰€æœ‰è‡ªåŠ¨åŒ–é€»è¾‘æ”¾ n8nï¼Œé€šè¿‡ HTTP è°ƒç”¨
- ä¿æŒç®€å•ï¼Œå¿«é€Ÿè¿­ä»£

---

## æŠ€æœ¯æ ˆ

```
æ¡†æ¶ï¼šNext.js 16 (App Router)
è¯­è¨€ï¼šTypeScript
æ ·å¼ï¼šTailwind CSS v4
ç»„ä»¶åº“ï¼šshadcn/ui
å›¾æ ‡ï¼šLucide React
æ•°æ®åº“ï¼šSQLiteï¼ˆæœ¬åœ°å¼€å‘ï¼‰/ PostgreSQLï¼ˆDockerï¼‰+ Prisma ORM
çŠ¶æ€ç®¡ç†ï¼šReact hooksï¼ˆä¸ç”¨ Reduxï¼‰
HTTP è¯·æ±‚ï¼šfetchï¼ˆä¸ç”¨ axiosï¼‰
å®¹å™¨åŒ–ï¼šDocker + docker-compose
å·¥ä½œæµå¼•æ“ï¼šn8n ä¸­æ–‡ç‰ˆ (blowsnow/n8n-chinese)
```

---

## ç›®å½•ç»“æ„

```
MoeDesk/
â”œâ”€â”€ docker-compose.yml            # Docker ç¼–æ’ï¼ˆapp + n8n + dbï¼‰
â”œâ”€â”€ Dockerfile                    # Next.js å¤šé˜¶æ®µæ„å»º
â”œâ”€â”€ .dockerignore                 # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ init-db.sql                   # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx                # å…¨å±€å¸ƒå±€ï¼ˆä¾§è¾¹æ ï¼‰
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µçœ‹æ¿
â”‚   â”œâ”€â”€ globals.css               # å…¨å±€æ ·å¼ + shadcn/ui å˜é‡
â”‚   â”œâ”€â”€ inbox/
â”‚   â”‚   â””â”€â”€ page.tsx              # ç»Ÿä¸€æ”¶ä»¶ç®±
â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”œâ”€â”€ page.tsx              # å†…å®¹æ—¥å†
â”‚   â”‚   â””â”€â”€ review/
â”‚   â”‚       â””â”€â”€ page.tsx          # å†…å®¹å®¡æ ¸
â”‚   â”œâ”€â”€ trending/
â”‚   â”‚   â””â”€â”€ page.tsx              # çƒ­ç‚¹é›·è¾¾
â”‚   â””â”€â”€ api/                      # API Routes
â”‚       â”œâ”€â”€ messages/
â”‚       â”‚   â””â”€â”€ route.ts          # æ¶ˆæ¯ CRUD
â”‚       â”œâ”€â”€ webhook/
â”‚       â”‚   â””â”€â”€ n8n/
â”‚       â”‚       â””â”€â”€ route.ts      # æ¥æ”¶ n8n æ¨é€
â”‚       â””â”€â”€ workflows/
â”‚           â””â”€â”€ route.ts          # è°ƒç”¨ n8n å·¥ä½œæµ
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                       # shadcn/ui ç»„ä»¶
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx           # ä¾§è¾¹å¯¼èˆª
â”‚   â”‚   â””â”€â”€ header.tsx            # é¡¶éƒ¨æ 
â”‚   â”œâ”€â”€ inbox/
â”‚   â”‚   â”œâ”€â”€ message-list.tsx      # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ message-detail.tsx    # æ¶ˆæ¯è¯¦æƒ…
â”‚   â”‚   â””â”€â”€ reply-box.tsx         # å›å¤è¾“å…¥æ¡†
â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”œâ”€â”€ calendar.tsx          # å†…å®¹æ—¥å†
â”‚   â”‚   â””â”€â”€ review-card.tsx       # å®¡æ ¸å¡ç‰‡
â”‚   â””â”€â”€ shared/
â”‚       â”œâ”€â”€ platform-badge.tsx    # å¹³å°æ ‡è¯†
â”‚       â”œâ”€â”€ status-badge.tsx      # çŠ¶æ€æ ‡è¯†
â”‚       â””â”€â”€ iframe-embed.tsx      # iframe åµŒå…¥ç»„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.ts                     # Prisma å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ n8n.ts                    # n8n API å°è£…
â”‚   â””â”€â”€ utils.ts                  # å·¥å…·å‡½æ•°ï¼ˆcn ç­‰ï¼‰
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                  # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma             # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ diagram/                      # HTML åŸå‹è®¾è®¡ç¨¿
â”‚   â”œâ”€â”€ inbox.html
â”‚   â”œâ”€â”€ review.html
â”‚   â””â”€â”€ trends.html
â””â”€â”€ public/
    â””â”€â”€ ...
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼

```typescript
// 1. ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ + TypeScript
export function MessageCard({ message }: { message: Message }) {
  return <div>...</div>
}

// 2. ä¸ç”¨ default exportï¼ˆé™¤äº†é¡µé¢ï¼‰
// å¥½
export function MessageList() {}
// é¿å…
export default function MessageList() {}

// 3. Props ç±»å‹å†…è”æˆ–ç”¨ interface
interface MessageCardProps {
  message: Message
  onReply: (content: string) => void
}

// 4. äº‹ä»¶å¤„ç†å‡½æ•°å‘½åï¼šhandle + åŠ¨ä½œ
const handleReply = () => {}
const handleMarkAsRead = () => {}

// 5. å¼‚æ­¥æ“ä½œä½¿ç”¨ async/await
async function fetchMessages() {
  const res = await fetch('/api/messages')
  return res.json()
}
```

### æ–‡ä»¶å‘½å

```
ç»„ä»¶æ–‡ä»¶ï¼škebab-caseï¼ˆmessage-list.tsxï¼‰
ç±»å‹æ–‡ä»¶ï¼škebab-caseï¼ˆindex.tsï¼‰
é¡µé¢æ–‡ä»¶ï¼šNext.js çº¦å®šï¼ˆpage.tsx, layout.tsxï¼‰
```

### æ ·å¼è§„èŒƒ

```typescript
// ä½¿ç”¨ Tailwindï¼Œä¸å†™è‡ªå®šä¹‰ CSS
// ä½¿ç”¨ cn() åˆå¹¶ classNameï¼ˆæ¥è‡ª shadcn/ui çš„ lib/utilsï¼‰

import { cn } from "@/lib/utils"

<div className={cn(
  "p-4 rounded-lg",
  isActive && "bg-blue-100",
  className
)}>
```

### API è®¾è®¡

```typescript
// API Routes ç»Ÿä¸€è¿”å›æ ¼å¼
// æˆåŠŸ
return Response.json({ data: messages })

// é”™è¯¯
return Response.json({ error: "Not found" }, { status: 404 })

// n8n Webhook è°ƒç”¨å°è£…
// lib/n8n.ts
const N8N_BASE_URL = process.env.N8N_WEBHOOK_URL || 'http://localhost:5678'

export async function triggerWorkflow(
  workflow: string, 
  payload: Record<string, any>
) {
  const res = await fetch(`${N8N_BASE_URL}/webhook/${workflow}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  return res.json()
}
```

---

## æ•°æ®æ¨¡å‹

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ç¤¾åª’æ¶ˆæ¯
model Message {
  id              String   @id @default(cuid())
  platform        String   // instagram, tiktok, twitter, xiaohongshu
  externalId      String   // å¹³å°åŸå§‹æ¶ˆæ¯ID
  userId          String   // å‘é€è€…ID
  userName        String
  userAvatar      String?
  userFollowers   Int      @default(0)
  content         String
  originalUrl     String   // åŸå¸–é“¾æ¥
  classification  String   // high_intent, inquiry, chat, complaint
  suggestedReply  String?  // AIå»ºè®®å›å¤
  status          String   @default("pending") // pending, replied, ignored
  repliedContent  String?  // å®é™…å›å¤å†…å®¹
  repliedAt       DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([platform])
  @@index([status])
  @@index([classification])
}

// å†…å®¹æ’æœŸ
model Content {
  id              String   @id @default(cuid())
  title           String
  productId       String?  // Shopify äº§å“ID
  productName     String?
  platform        String
  content         String   // æ­£æ–‡
  hashtags        String?  // JSON æ•°ç»„
  mediaUrls       String?  // JSON æ•°ç»„
  scheduledAt     DateTime?
  status          String   @default("draft") // draft, pending_review, approved, published, rejected
  reviewNote      String?
  publishedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([platform])
  @@index([status])
  @@index([scheduledAt])
}

// çƒ­ç‚¹è¿½è¸ª
model Trending {
  id              String   @id @default(cuid())
  source          String   // reddit, anilist, twitter
  title           String
  url             String?
  score           Float    // AIè¯„åˆ†
  relevance       Float    // å“ç‰Œç›¸å…³åº¦
  relatedProducts String?  // JSON æ•°ç»„ï¼ŒåŒ¹é…çš„äº§å“ID
  status          String   @default("new") // new, picked, ignored
  createdAt       DateTime @default(now())

  @@index([source])
  @@index([status])
  @@index([score])
}
```

---

## æ ¸å¿ƒé¡µé¢éœ€æ±‚

### 1. é¦–é¡µçœ‹æ¿ (/)

```
å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»Šæ—¥æ¦‚è§ˆ                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚å¾…å¤„ç†æ¶ˆæ¯â”‚ â”‚å¾…å®¡æ ¸å†…å®¹â”‚ â”‚ä»Šæ—¥å‘å¸ƒ â”‚ â”‚æ–°çƒ­ç‚¹   â”‚   â”‚
â”‚  â”‚   23    â”‚ â”‚   5     â”‚ â”‚   8     â”‚ â”‚   12    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¾…åŠäº‹é¡¹ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰                             â”‚
â”‚  - ğŸ”´ 3æ¡é«˜æ„å‘æ¶ˆæ¯å¾…å›å¤                            â”‚
â”‚  - ğŸŸ¡ 5æ¡å†…å®¹å¾…å®¡æ ¸                                  â”‚
â”‚  - ğŸŸ¢ 2æ¡å®šæ—¶å‘å¸ƒå¾…ç¡®è®¤                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®æ¥æºï¼š
- GET /api/stats è·å–ç»Ÿè®¡æ•°æ®
- GET /api/todos è·å–å¾…åŠåˆ—è¡¨
```

### 2. ç»Ÿä¸€æ”¶ä»¶ç®± (/inbox)

```
å¸ƒå±€ï¼šå·¦å³åˆ†æ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç­›é€‰æ             â”‚ æ¶ˆæ¯è¯¦æƒ…                          â”‚
â”‚ [å…¨éƒ¨][å¾…å¤„ç†]... â”‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ç”¨æˆ·ä¿¡æ¯å¡ç‰‡                       â”‚
â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ æ¶ˆæ¯åˆ—è¡¨          â”‚ â”‚ å¤´åƒ  ç”¨æˆ·å                  â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚       å¹³å° | ç²‰ä¸æ•° | å†å²äº’åŠ¨â”‚  â”‚
â”‚ â”‚ æ¶ˆæ¯å¡ç‰‡1    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚ å¹³å° | æ—¶é—´  â”‚ â”‚                                   â”‚
â”‚ â”‚ å†…å®¹é¢„è§ˆ...  â”‚ â”‚ æ¶ˆæ¯å†…å®¹                          â”‚
â”‚ â”‚ åˆ†ç±»æ ‡ç­¾     â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ å®Œæ•´æ¶ˆæ¯æ–‡æœ¬                  â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚ æ¶ˆæ¯å¡ç‰‡2    â”‚ â”‚                                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ åŸå¸–é¢„è§ˆ (iframe)                 â”‚
â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ ...              â”‚ â”‚                              â”‚  â”‚
â”‚                  â”‚ â”‚   iframe åµŒå…¥åŸå§‹å¸–å­         â”‚  â”‚
â”‚                  â”‚ â”‚                              â”‚  â”‚
â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                   â”‚
â”‚                  â”‚ å›å¤åŒºåŸŸ                          â”‚
â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                  â”‚ â”‚ AIå»ºè®®: "é“¾æ¥åœ¨ä¸»é¡µbioå“¦ï½"   â”‚  â”‚
â”‚                  â”‚ â”‚ [é‡‡çº³] [ç¼–è¾‘]                 â”‚  â”‚
â”‚                  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                  â”‚ â”‚ è¾“å…¥å›å¤å†…å®¹...               â”‚  â”‚
â”‚                  â”‚ â”‚              [å‘é€] [è·³è¿‡]    â”‚  â”‚
â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

äº¤äº’ï¼š
- ç‚¹å‡»æ¶ˆæ¯å¡ç‰‡ï¼Œå³ä¾§æ˜¾ç¤ºè¯¦æƒ…
- ç­›é€‰æ”¯æŒï¼šå¹³å°ã€åˆ†ç±»ã€çŠ¶æ€
- å›å¤åè‡ªåŠ¨æ ‡è®°å·²å¤„ç†ï¼Œåˆ—è¡¨ç§»é™¤æˆ–å˜ç°

APIï¼š
- GET /api/messages?platform=&status=&classification=
- PATCH /api/messages/:id ï¼ˆæ›´æ–°çŠ¶æ€ï¼‰
- POST /api/messages/:id/reply ï¼ˆå‘é€å›å¤ï¼Œè°ƒç”¨ n8nï¼‰

ç‰¹æ®Šå¤„ç†ï¼š
- iframe åµŒå…¥éœ€è¦å¤„ç†è·¨åŸŸï¼Œéƒ¨åˆ†å¹³å°å¯èƒ½ä¸æ”¯æŒ
- ä¸æ”¯æŒ iframe çš„æ˜¾ç¤º"åœ¨æ–°çª—å£æ‰“å¼€"é“¾æ¥
```

### 3. å†…å®¹å®¡æ ¸ (/content/review)

```
å¸ƒå±€ï¼šå¡ç‰‡åˆ—è¡¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾…å®¡æ ¸å†…å®¹                              [æ‰¹é‡é€šè¿‡]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ äº§å“: å’’æœ¯å›æˆ˜ äº”æ¡æ‚Ÿæ‰‹åŠ                        â”‚ â”‚
â”‚ â”‚ å¹³å°: Instagram | è®¡åˆ’å‘å¸ƒ: 2024-01-15 18:00    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ AIç”Ÿæˆå†…å®¹:                                      â”‚ â”‚
â”‚ â”‚ "é¢†åŸŸå±•å¼€ï¼äº”æ¡æ‚Ÿ1/7æ¯”ä¾‹æ‰‹åŠç»ˆäºåˆ°è´§..."          â”‚ â”‚
â”‚ â”‚ #å’’æœ¯å›æˆ˜ #äº”æ¡æ‚Ÿ #æ‰‹åŠ ...                      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [ç¼–è¾‘] [é€šè¿‡] [æ‹’ç»] [é‡æ–°ç”Ÿæˆ]                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ä¸‹ä¸€æ¡...                                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APIï¼š
- GET /api/content?status=pending_review
- PATCH /api/content/:id ï¼ˆå®¡æ ¸æ“ä½œï¼‰
- POST /api/content/:id/regenerate ï¼ˆè°ƒç”¨ n8n é‡æ–°ç”Ÿæˆï¼‰
```

### 4. çƒ­ç‚¹é›·è¾¾ (/trending)

```
å¸ƒå±€ï¼šåˆ—è¡¨ + æ“ä½œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»Šæ—¥çƒ­ç‚¹                            [åˆ·æ–°] [è®¾ç½®]   â”‚
â”‚ æ•°æ®æº: Reddit / AniList / Twitter                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”¥ å’’æœ¯å›æˆ˜å‰§åœºç‰ˆç¥¨æˆ¿ç ´ç™¾äº¿                       â”‚ â”‚
â”‚ â”‚ æ¥æº: Twitter | çƒ­åº¦: 95 | ç›¸å…³åº¦: 0.89          â”‚ â”‚
â”‚ â”‚ åŒ¹é…äº§å“: äº”æ¡æ‚Ÿæ‰‹åŠã€è™æ–æ‚ ä»å‘¨è¾¹                â”‚ â”‚
â”‚ â”‚ [åˆ›å»ºå†…å®¹] [åŠ å…¥é€‰é¢˜æ± ] [å¿½ç•¥]                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ˆ é—´è°è¿‡å®¶å®¶ç¬¬ä¸‰å­£å®šæ¡£                          â”‚ â”‚
â”‚ â”‚ æ¥æº: AniList | çƒ­åº¦: 88 | ç›¸å…³åº¦: 0.75         â”‚ â”‚
â”‚ â”‚ ...                                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

APIï¼š
- GET /api/trending?status=new
- PATCH /api/trending/:id ï¼ˆæ ‡è®°çŠ¶æ€ï¼‰
- POST /api/trending/:id/create-content ï¼ˆè°ƒç”¨ n8n ç”Ÿæˆå†…å®¹ï¼‰
```

---

## n8n é›†æˆç‚¹

### å‰ç«¯è°ƒç”¨ n8nï¼ˆä¸»åŠ¨ï¼‰

```typescript
// lib/n8n.ts
export const N8N_WORKFLOWS = {
  // ç”Ÿæˆå†…å®¹
  GENERATE_CONTENT: 'generate-content',
  // å‘é€å›å¤
  SEND_REPLY: 'send-reply',
  // åˆ·æ–°çƒ­ç‚¹
  REFRESH_TRENDING: 'refresh-trending',
  // å‘å¸ƒå†…å®¹
  PUBLISH_CONTENT: 'publish-content',
} as const

// è°ƒç”¨ç¤ºä¾‹
await triggerWorkflow(N8N_WORKFLOWS.GENERATE_CONTENT, {
  productId: 'SKU123',
  platform: 'instagram',
  trendingTopic: 'å’’æœ¯å›æˆ˜'
})
```

### n8n æ¨é€åˆ°å‰ç«¯ï¼ˆè¢«åŠ¨ï¼‰

```typescript
// app/api/webhook/n8n/route.ts
export async function POST(request: Request) {
  const payload = await request.json()
  
  switch (payload.type) {
    case 'new_message':
      // æ–°æ¶ˆæ¯å…¥åº“
      await prisma.message.create({ data: payload.message })
      break
    case 'content_generated':
      // æ–°å†…å®¹å…¥åº“
      await prisma.content.create({ data: payload.content })
      break
    case 'trending_update':
      // çƒ­ç‚¹æ›´æ–°
      await prisma.trending.createMany({ data: payload.items })
      break
  }
  
  return Response.json({ received: true })
}
```

---

## å¼€å‘é¡ºåº

```
Phase 1: åŸºç¡€æ¡†æ¶ âœ… å·²å®Œæˆ
â”œâ”€â”€ âœ… åˆå§‹åŒ– Next.js é¡¹ç›®ï¼ˆTypeScript + Tailwind CSS v4ï¼‰
â”œâ”€â”€ âœ… é…ç½® shadcn/ui
â”œâ”€â”€ âœ… Docker å®¹å™¨åŒ–ï¼ˆDockerfile + docker-composeï¼‰
â”œâ”€â”€ âœ… é›†æˆ n8n ä¸­æ–‡ç‰ˆ + PostgreSQL
â”œâ”€â”€ åˆ›å»ºå…¨å±€å¸ƒå±€ï¼ˆä¾§è¾¹æ  + é¡¶æ ï¼‰
â”œâ”€â”€ é…ç½® Prisma + SQLite/PostgreSQL
â””â”€â”€ åˆ›å»ºåŸºç¡€ API ç»“æ„

Phase 2: ç»Ÿä¸€æ”¶ä»¶ç®±
â”œâ”€â”€ æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
â”œâ”€â”€ æ¶ˆæ¯è¯¦æƒ…ç»„ä»¶
â”œâ”€â”€ iframe åµŒå…¥ç»„ä»¶
â”œâ”€â”€ å›å¤åŠŸèƒ½
â””â”€â”€ æ¶ˆæ¯ API

Phase 3: å†…å®¹ç®¡ç†
â”œâ”€â”€ å†…å®¹å®¡æ ¸é¡µé¢
â”œâ”€â”€ å†…å®¹æ—¥å†é¡µé¢
â”œâ”€â”€ n8n é›†æˆå°è£…
â””â”€â”€ å†…å®¹ API

Phase 4: çƒ­ç‚¹é›·è¾¾ + é¦–é¡µ
â”œâ”€â”€ çƒ­ç‚¹åˆ—è¡¨é¡µé¢
â”œâ”€â”€ é¦–é¡µçœ‹æ¿
â”œâ”€â”€ ç»Ÿè®¡ API
â””â”€â”€ æ•´ä½“è”è°ƒ
```

---

## å¯åŠ¨å‘½ä»¤

```bash
# Docker å¯åŠ¨ï¼ˆæ¨èï¼‰
docker-compose up -d              # å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆå‰ç«¯ + n8n + PostgreSQLï¼‰
docker-compose down               # åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose logs -f            # æŸ¥çœ‹æ—¥å¿—
docker-compose up -d --build      # é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose ps                 # æŸ¥çœ‹æœåŠ¡çŠ¶æ€

# æœ¬åœ°å¼€å‘ï¼ˆä¸ä½¿ç”¨ Dockerï¼‰
npm run dev

# æ•°æ®åº“
npx prisma db push    # åŒæ­¥ schema åˆ°æ•°æ®åº“
npx prisma studio     # å¯è§†åŒ–æ•°æ®åº“ç®¡ç†

# æ„å»º
npm run build
npm start
```

---

## ç¯å¢ƒå˜é‡

```env
# .env.localï¼ˆæœ¬åœ°å¼€å‘ï¼‰
DATABASE_URL="file:./dev.db"
N8N_WEBHOOK_URL="http://localhost:5678"

# Docker ç¯å¢ƒï¼ˆåœ¨ docker-compose.yml ä¸­é…ç½®ï¼‰
DATABASE_URL="postgresql://postgres:postgres@db:5432/moedesk"
N8N_WEBHOOK_URL="http://n8n:5678"
```

---

## Docker æœåŠ¡æ¶æ„

docker-compose åŒ…å«ä¸‰ä¸ªæœåŠ¡ï¼š

| æœåŠ¡ | é•œåƒ | ç«¯å£ | è¯´æ˜ |
|------|------|------|------|
| app | moedesk-app | 3000 | Next.js å‰ç«¯åº”ç”¨ |
| n8n | blowsnow/n8n-chinese | 5678 | å·¥ä½œæµå¼•æ“ï¼ˆä¸­æ–‡ç‰ˆï¼‰ |
| db | postgres:16-alpine | 15432 | PostgreSQL æ•°æ®åº“ |

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ï¼šhttp://localhost:3000
- n8n å·¥ä½œæµï¼šhttp://localhost:5678
- æ•°æ®åº“ï¼šlocalhost:15432ï¼ˆç”¨æˆ·: postgresï¼Œå¯†ç : postgresï¼‰

---

## æ³¨æ„äº‹é¡¹

1. **iframe å…¼å®¹æ€§**ï¼šInstagram/TikTok å¯èƒ½ç¦æ­¢ iframe åµŒå…¥ï¼Œéœ€è¦æ£€æµ‹å¹¶é™çº§ä¸º"æ–°çª—å£æ‰“å¼€"
2. **æ¶ˆæ¯å®æ—¶æ€§**ï¼šåˆç‰ˆç”¨è½®è¯¢ï¼Œåç»­å¯åŠ  WebSocket
3. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰ API è°ƒç”¨è¦æœ‰ try-catch å’Œç”¨æˆ·æç¤º
4. **åŠ è½½çŠ¶æ€**ï¼šåˆ—è¡¨å’Œæ“ä½œéƒ½è¦æœ‰ loading çŠ¶æ€
5. **ç§»åŠ¨ç«¯**ï¼šæš‚ä¸è€ƒè™‘ï¼Œå…ˆåšæ¡Œé¢ç«¯
