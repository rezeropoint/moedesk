# 全栈编码规范

> 基于 **Next.js 16** + **React 19** + **Tailwind CSS v4** + **shadcn/ui (new-york)**
> 为统一代码风格、保障可维护性而制定

---

## 核心原则

1. **拥抱最新特性，禁止废弃 API** - 始终使用框架/库的最新推荐写法，绝不使用已废弃或即将废弃的 API
2. **统一使用 shadcn/ui 体系** - 禁止原生 HTML 交互元素，优先使用封装组件
3. **Tailwind CSS 优先** - 使用语义化 class，禁止内联 style（除动态计算值）
4. **禁止硬编码颜色** - 不允许 `#fff`、`rgb()`、`oklch()` 等，使用 CSS 变量
5. **TypeScript 严格模式** - 禁止 `any`，所有 props/参数必须定义类型
6. **React 19 + RSC 写法** - 优先 Server Components，必要时才用 `"use client"`
7. **前后端职责分离** - 前端负责展示交互，后端（API Route / n8n）处理业务逻辑

---

## 最新特性 vs 废弃 API

### 核心理念

**始终追踪最新稳定版本的推荐写法，绝不使用废弃 API。** 废弃 API 即使仍能运行，也会：
- 在未来版本被移除，导致升级困难
- 缺少新特性的性能优化
- 官方文档不再维护，遇到问题难以排查

### React 19 新特性（必须使用）

```tsx
// ✅ React 19：use() hook 替代 useEffect 数据获取
import { use } from "react"

function Comments({ commentsPromise }: { commentsPromise: Promise<Comment[]> }) {
  const comments = use(commentsPromise)  // 自动 Suspense
  return <ul>{comments.map(c => <li key={c.id}>{c.text}</li>)}</ul>
}

// ✅ React 19：useActionState 替代手动管理表单状态
import { useActionState } from "react"

function Form() {
  const [state, action, isPending] = useActionState(submitForm, initialState)
  return <form action={action}>...</form>
}

// ✅ React 19：useOptimistic 乐观更新
import { useOptimistic } from "react"

function MessageList({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimistic] = useOptimistic(
    messages,
    (state, newMessage: Message) => [...state, newMessage]
  )
  // ...
}

// ✅ React 19：ref 作为 prop（不再需要 forwardRef）
function Input({ ref, ...props }: { ref?: React.Ref<HTMLInputElement> }) {
  return <input ref={ref} {...props} />
}
```

### React 废弃 API（禁止使用）

| 废弃 API | 替代方案 | 说明 |
|----------|----------|------|
| `forwardRef` | 直接传 ref prop | React 19 原生支持 |
| `useEffect` 数据获取 | `use()` + Suspense | 更好的加载状态处理 |
| `PropTypes` | TypeScript | 编译时类型检查 |
| `defaultProps` | ES6 默认参数 | `{ name = "default" }` |
| `createContext` displayName | 使用 DevTools | 开发工具自动识别 |

```tsx
// ❌ 禁止：forwardRef（React 19 废弃）
const Input = forwardRef<HTMLInputElement, Props>((props, ref) => {
  return <input ref={ref} {...props} />
})

// ✅ 正确：直接接收 ref
function Input({ ref, ...props }: Props & { ref?: React.Ref<HTMLInputElement> }) {
  return <input ref={ref} {...props} />
}

// ❌ 禁止：defaultProps
MyComponent.defaultProps = { name: "default" }

// ✅ 正确：ES6 默认参数
function MyComponent({ name = "default" }: Props) { }
```

### Next.js 16 新特性（必须使用）

```tsx
// ✅ Next.js 16：App Router（非 Pages Router）
// app/messages/page.tsx
export default async function MessagesPage() {
  const data = await fetchMessages()
  return <MessageList messages={data} />
}

// ✅ Next.js 16：Server Actions
"use server"

export async function createMessage(formData: FormData) {
  const content = formData.get("content")
  await db.message.create({ data: { content } })
  revalidatePath("/messages")
}

// ✅ Next.js 16：Metadata API
export const metadata: Metadata = {
  title: "消息收件箱",
  description: "管理您的社媒消息",
}

// ✅ Next.js 16：Route Handlers（非 API Routes 旧写法）
// app/api/messages/route.ts
export async function GET(request: Request) {
  const messages = await db.message.findMany()
  return Response.json({ data: messages })
}
```

### Next.js 废弃写法（禁止使用）

| 废弃写法 | 替代方案 | 说明 |
|----------|----------|------|
| `pages/` 目录 | `app/` 目录 | App Router |
| `getServerSideProps` | Server Component 直接 fetch | RSC 原生支持 |
| `getStaticProps` | Server Component + cache | 静态生成 |
| `/pages/api/*.ts` | `/app/api/*/route.ts` | Route Handlers |
| `next/head` | `metadata` 导出 | Metadata API |
| `next/image` legacy | `next/image` (默认) | 已移除 legacy |

```tsx
// ❌ 禁止：Pages Router 写法
// pages/messages.tsx
export async function getServerSideProps() {
  const messages = await fetchMessages()
  return { props: { messages } }
}

// ✅ 正确：App Router Server Component
// app/messages/page.tsx
export default async function MessagesPage() {
  const messages = await fetchMessages()
  return <MessageList messages={messages} />
}
```

---

## 组件使用规范

### 禁止使用原生 HTML 交互元素

所有 UI 交互组件必须使用 shadcn/ui，确保主题一致性和可访问性。

| 原生 HTML | 禁止原因 | 使用替代 |
|-----------|----------|----------|
| `<button>` | 无样式一致性 | `<Button>` |
| `<input>` | 缺少主题适配 | `<Input>` / `<Textarea>` |
| `<select>` | 样式不统一 | `<Select>` |
| `<checkbox>` | 缺少状态样式 | `<Checkbox>` |
| `<radio>` | 缺少状态样式 | `<RadioGroup>` |
| `<dialog>` | 缺少动画和遮罩 | `<Dialog>` / `<Sheet>` |
| `<a>` 按钮样式 | 语义不正确 | `<Button variant="link">` |
| `<table>` | 缺少响应式 | `<Table>` |
| `<form>` | 无验证集成 | 配合 `react-hook-form` + `<Form>` |

### 优先级：封装组件 > shadcn/ui > 原生

```tsx
// ❌ 禁止：原生 HTML 交互元素
<button onClick={handleClick}>提交</button>
<input type="text" value={name} onChange={e => setName(e.target.value)} />
<select><option>选项</option></select>

// ⚠️ 可用：shadcn/ui 基础组件
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
<Button onClick={handleClick}>提交</Button>
<Input value={name} onChange={e => setName(e.target.value)} />

// ✅ 推荐：业务封装组件（可复用逻辑）
import { MessageCard } from "@/components/message-card"
import { PlatformSelect } from "@/components/platform-select"
<MessageCard message={message} onReply={handleReply} />
<PlatformSelect value={platform} onChange={setPlatform} />
```

### 例外情况

以下场景允许使用原生 HTML：

1. **语义化结构元素**：`<header>`、`<main>`、`<section>`、`<article>`、`<nav>`、`<aside>`
2. **纯布局容器**：`<div>` 用于 flex/grid 布局包裹
3. **文本元素**：`<p>`、`<span>`、`<h1>`~`<h6>`、`<strong>`、`<em>`
4. **列表展示**：`<ul>`、`<ol>`、`<li>`（纯展示，非交互）
5. **图片**：`<img>` 或 Next.js `<Image>`
6. **链接导航**：`<a>` 配合 Next.js `<Link>`（真实页面跳转）

---

## 样式规范

### Tailwind CSS 优先

所有样式必须使用 Tailwind CSS class，利用 `cn()` 合并 className。

```tsx
import { cn } from "@/lib/utils"

// ✅ 正确：使用 Tailwind class
<div className="flex items-center gap-4 p-4 rounded-lg bg-card">
  <span className="text-muted-foreground">描述文字</span>
</div>

// ✅ 正确：条件样式用 cn()
<div className={cn(
  "px-4 py-2 rounded-md",
  isActive && "bg-primary text-primary-foreground",
  isDisabled && "opacity-50 cursor-not-allowed"
)}>
  内容
</div>

// ❌ 禁止：内联 style
<div style={{ backgroundColor: '#fff', padding: '16px' }}>

// ❌ 禁止：硬编码颜色
<div className="bg-[#ffffff] text-[#262626]">
```

### 何时使用内联 style

仅用于动态计算的位置/尺寸值：

```tsx
// ✅ 允许：动态计算值
<div style={{
  left: `${position}px`,
  width: `${progress}%`,
  transform: `translateX(${offset}px)`
}} />

// ✅ 允许：CSS 变量动态赋值
<div style={{ '--progress': `${percent}%` } as React.CSSProperties} />
```

### 语义化颜色速查

使用 shadcn/ui 定义的语义化颜色变量：

| 用途 | Tailwind Class | CSS 变量 |
|------|---------------|----------|
| **背景色** |||
| 页面背景 | `bg-background` | `--background` |
| 卡片背景 | `bg-card` | `--card` |
| 弹层背景 | `bg-popover` | `--popover` |
| 次要背景 | `bg-muted` | `--muted` |
| 强调背景 | `bg-accent` | `--accent` |
| **文字色** |||
| 主文本 | `text-foreground` | `--foreground` |
| 次要文本 | `text-muted-foreground` | `--muted-foreground` |
| 卡片文本 | `text-card-foreground` | `--card-foreground` |
| **功能色** |||
| 主题色 | `bg-primary` / `text-primary` | `--primary` |
| 次要色 | `bg-secondary` / `text-secondary` | `--secondary` |
| 危险色 | `bg-destructive` / `text-destructive` | `--destructive` |
| **边框色** |||
| 默认边框 | `border-border` | `--border` |
| 输入框边框 | `border-input` | `--input` |
| 焦点环 | `ring-ring` | `--ring` |

### 响应式设计

使用 Tailwind 断点，移动优先：

```tsx
// ✅ 正确：移动优先，逐级覆盖
<div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
  {items.map(item => <Card key={item.id} />)}
</div>

// ✅ 正确：响应式间距和布局
<div className="p-4 md:p-6 lg:p-8">
  <h1 className="text-xl md:text-2xl lg:text-3xl font-bold">
    标题
  </h1>
</div>
```

| 断点 | 宽度 | 典型设备 |
|------|------|----------|
| 默认 | < 768px | 手机 |
| `md:` | >= 768px | 平板 |
| `lg:` | >= 1024px | 笔记本 |
| `xl:` | >= 1280px | 桌面 |
| `2xl:` | >= 1536px | 大屏 |

---

## 图标规范

### 统一使用 Lucide React

```tsx
import { Mail, Send, Trash2, MoreHorizontal } from "lucide-react"

// ✅ 正确：使用 Lucide 图标
<Button>
  <Mail className="mr-2 h-4 w-4" />
  发送消息
</Button>

// ✅ 正确：图标按钮
<Button variant="ghost" size="icon">
  <Trash2 className="h-4 w-4" />
</Button>

// ❌ 禁止：混用其他图标库
import { FaEnvelope } from "react-icons/fa"  // 禁止
```

### 图标尺寸规范

| 场景 | 尺寸 Class | 像素 |
|------|-----------|------|
| 按钮内图标 | `h-4 w-4` | 16px |
| 图标按钮 | `h-4 w-4` | 16px |
| 列表项图标 | `h-5 w-5` | 20px |
| 卡片图标 | `h-6 w-6` | 24px |
| 大图标/空状态 | `h-12 w-12` | 48px |

---

## 组件开发规范

### 文件命名

```
components/
├── ui/                    # shadcn/ui 组件（自动生成）
│   ├── button.tsx
│   └── input.tsx
├── message-card.tsx       # 业务组件（kebab-case）
├── platform-select.tsx
└── trending-list.tsx
```

### 组件结构

```tsx
// ✅ 正确：标准组件结构
import { cn } from "@/lib/utils"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Mail, Reply } from "lucide-react"

interface MessageCardProps {
  message: Message
  onReply: (id: string) => void
  className?: string
}

export function MessageCard({ message, onReply, className }: MessageCardProps) {
  const handleReply = () => {
    onReply(message.id)
  }

  return (
    <Card className={cn("hover:shadow-md transition-shadow", className)}>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Mail className="h-4 w-4" />
          {message.subject}
        </CardTitle>
      </CardHeader>
      <CardContent>
        <p className="text-muted-foreground">{message.content}</p>
        <Button onClick={handleReply} className="mt-4">
          <Reply className="mr-2 h-4 w-4" />
          回复
        </Button>
      </CardContent>
    </Card>
  )
}
```

### 命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 组件文件 | kebab-case | `message-card.tsx` |
| 组件名 | PascalCase | `MessageCard` |
| 事件处理 | handle + 动作 | `handleReply`, `handleSubmit` |
| Props 接口 | 组件名 + Props | `MessageCardProps` |
| 布尔 Props | is/has/can 前缀 | `isLoading`, `hasError`, `canEdit` |

### 禁止 default export

页面组件除外，所有组件使用具名导出：

```tsx
// ✅ 正确：具名导出
export function MessageCard() { }
export function MessageList() { }

// ❌ 禁止：默认导出（页面除外）
export default function MessageCard() { }
```

---

## Server Components vs Client Components

### 优先使用 Server Components

```tsx
// ✅ 默认 Server Component（无需标记）
// app/messages/page.tsx
import { MessageList } from "@/components/message-list"

export default async function MessagesPage() {
  const messages = await fetch('/api/messages').then(r => r.json())
  return <MessageList messages={messages} />
}
```

### 何时使用 Client Components

仅在需要以下功能时添加 `"use client"`：

```tsx
"use client"

import { useState } from "react"

// ✅ 需要交互状态
export function MessageComposer() {
  const [content, setContent] = useState("")
  return <textarea value={content} onChange={e => setContent(e.target.value)} />
}
```

| 功能 | 组件类型 |
|------|----------|
| 数据获取 | Server |
| 静态展示 | Server |
| 点击/输入交互 | Client |
| useState/useEffect | Client |
| 浏览器 API | Client |
| 第三方客户端库 | Client |

---

## 后端规范（API Route / Server Actions）

### 目录结构

```
app/
├── api/                          # REST API（供外部或客户端调用）
│   ├── messages/
│   │   ├── route.ts              # GET /api/messages, POST /api/messages
│   │   └── [id]/
│   │       └── route.ts          # GET/PATCH/DELETE /api/messages/:id
│   └── trending/
│       └── route.ts
├── actions/                      # Server Actions（表单提交、mutations）
│   ├── message-actions.ts
│   └── content-actions.ts
└── (pages)/
    └── messages/
        └── page.tsx
```

### Route Handler 规范

```ts
// app/api/messages/route.ts
import { NextRequest } from "next/server"
import { db } from "@/lib/db"
import { z } from "zod"

// ✅ 类型安全的请求验证
const createMessageSchema = z.object({
  content: z.string().min(1).max(1000),
  platform: z.enum(["twitter", "instagram", "tiktok"]),
})

// ✅ GET：查询列表
export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams
  const page = Number(searchParams.get("page")) || 1
  const pageSize = Number(searchParams.get("pageSize")) || 10

  const [messages, total] = await Promise.all([
    db.message.findMany({
      skip: (page - 1) * pageSize,
      take: pageSize,
      orderBy: { createdAt: "desc" },
    }),
    db.message.count(),
  ])

  return Response.json({
    data: messages,
    pagination: { page, pageSize, total },
  })
}

// ✅ POST：创建资源
export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    const validated = createMessageSchema.parse(body)

    const message = await db.message.create({
      data: validated,
    })

    return Response.json({ data: message }, { status: 201 })
  } catch (error) {
    if (error instanceof z.ZodError) {
      return Response.json(
        { error: "Validation failed", details: error.errors },
        { status: 400 }
      )
    }
    return Response.json({ error: "Internal server error" }, { status: 500 })
  }
}
```

```ts
// app/api/messages/[id]/route.ts
import { NextRequest } from "next/server"

type RouteContext = { params: Promise<{ id: string }> }

// ✅ Next.js 15+：params 是 Promise
export async function GET(request: NextRequest, context: RouteContext) {
  const { id } = await context.params

  const message = await db.message.findUnique({ where: { id } })

  if (!message) {
    return Response.json({ error: "Message not found" }, { status: 404 })
  }

  return Response.json({ data: message })
}

export async function DELETE(request: NextRequest, context: RouteContext) {
  const { id } = await context.params

  await db.message.delete({ where: { id } })

  return new Response(null, { status: 204 })
}
```

### Server Actions 规范

```ts
// app/actions/message-actions.ts
"use server"

import { revalidatePath } from "next/cache"
import { redirect } from "next/navigation"
import { z } from "zod"
import { db } from "@/lib/db"

const replySchema = z.object({
  messageId: z.string(),
  content: z.string().min(1).max(500),
})

// ✅ 表单 Action：返回状态对象
export async function sendReply(prevState: unknown, formData: FormData) {
  const rawData = {
    messageId: formData.get("messageId"),
    content: formData.get("content"),
  }

  const result = replySchema.safeParse(rawData)

  if (!result.success) {
    return { error: result.error.flatten().fieldErrors }
  }

  try {
    await db.message.update({
      where: { id: result.data.messageId },
      data: {
        status: "replied",
        reply: result.data.content,
        repliedAt: new Date(),
      },
    })

    revalidatePath("/messages")
    return { success: true }
  } catch {
    return { error: { _form: ["发送失败，请重试"] } }
  }
}

// ✅ 直接调用 Action（非表单）
export async function markAsRead(messageId: string) {
  await db.message.update({
    where: { id: messageId },
    data: { status: "read", readAt: new Date() },
  })

  revalidatePath("/messages")
}

// ✅ 带重定向的 Action
export async function deleteMessage(messageId: string) {
  await db.message.delete({ where: { id: messageId } })

  revalidatePath("/messages")
  redirect("/messages")
}
```

### API 响应格式统一

```ts
// ✅ 成功响应
return Response.json({ data: messages })

// ✅ 创建成功
return Response.json({ data: newMessage }, { status: 201 })

// ✅ 删除成功（无内容）
return new Response(null, { status: 204 })

// ✅ 带分页
return Response.json({
  data: messages,
  pagination: { page: 1, pageSize: 10, total: 100 }
})

// ✅ 客户端错误
return Response.json({ error: "Validation failed", details: [...] }, { status: 400 })
return Response.json({ error: "Not found" }, { status: 404 })

// ✅ 服务端错误
return Response.json({ error: "Internal server error" }, { status: 500 })
```

### 与 n8n 工作流通信

```ts
// lib/n8n.ts
export const N8N_WEBHOOK_URL = process.env.N8N_WEBHOOK_URL || "http://localhost:5678"

export const N8N_WORKFLOWS = {
  GENERATE_CONTENT: 'generate-content',
  SEND_REPLY: 'send-reply',
  REFRESH_TRENDING: 'refresh-trending',
  PUBLISH_CONTENT: 'publish-content',
} as const

export async function triggerWorkflow<T>(
  workflow: string,
  data: Record<string, unknown>
): Promise<T> {
  const response = await fetch(`${N8N_WEBHOOK_URL}/webhook/${workflow}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data),
  })

  if (!response.ok) {
    throw new Error(`Workflow ${workflow} failed: ${response.statusText}`)
  }

  return response.json()
}
```

### Node.js 现代写法

```ts
// ✅ 使用 ES Modules（非 CommonJS）
import { db } from "@/lib/db"        // 非 const db = require(...)

// ✅ 使用 fetch API（非 axios/node-fetch）
const response = await fetch(url)    // Node 18+ 原生支持

// ✅ 使用 crypto.randomUUID()（非 uuid 库）
const id = crypto.randomUUID()

// ✅ 使用 structuredClone()（非 JSON.parse(JSON.stringify())）
const copy = structuredClone(original)

// ✅ 使用 Array.at()（非 arr[arr.length - 1]）
const last = arr.at(-1)

// ✅ 使用 Object.hasOwn()（非 obj.hasOwnProperty()）
if (Object.hasOwn(obj, "key")) { }
```

### 后端禁止事项

```ts
// ❌ 禁止：CommonJS
const db = require("./db")
module.exports = { handler }

// ❌ 禁止：旧版 API Route 写法
// pages/api/messages.ts
export default function handler(req, res) {
  res.json({ data: [] })
}

// ❌ 禁止：不验证输入
export async function POST(request: Request) {
  const body = await request.json()
  await db.create({ data: body })  // 危险！
}

// ❌ 禁止：暴露敏感信息
return Response.json({ error: error.stack }, { status: 500 })

// ❌ 禁止：同步阻塞操作
import fs from "fs"
const data = fs.readFileSync(path)  // 使用 fs/promises
```

---

## 表单规范

### 使用 react-hook-form + zod

```tsx
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import { Button } from "@/components/ui/button"
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form"
import { Input } from "@/components/ui/input"

const formSchema = z.object({
  title: z.string().min(1, "标题不能为空").max(100, "标题不能超过100字"),
  content: z.string().min(1, "内容不能为空"),
})

type FormValues = z.infer<typeof formSchema>

export function ContentForm() {
  const form = useForm<FormValues>({
    resolver: zodResolver(formSchema),
    defaultValues: { title: "", content: "" },
  })

  const handleSubmit = (values: FormValues) => {
    console.log(values)
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="title"
          render={({ field }) => (
            <FormItem>
              <FormLabel>标题</FormLabel>
              <FormControl>
                <Input placeholder="请输入标题" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <Button type="submit" disabled={form.formState.isSubmitting}>
          提交
        </Button>
      </form>
    </Form>
  )
}
```

---

## 状态管理规范

### 优先使用 React 内置方案

| 场景 | 方案 |
|------|------|
| 组件内状态 | `useState` |
| 复杂组件状态 | `useReducer` |
| 跨组件共享 | React Context |
| 服务端数据 | Server Components + props 传递 |
| URL 状态 | `useSearchParams` / `useRouter` |

```tsx
// ✅ 简单状态
const [isOpen, setIsOpen] = useState(false)

// ✅ URL 状态同步
import { useSearchParams, useRouter } from "next/navigation"

export function FilterBar() {
  const searchParams = useSearchParams()
  const router = useRouter()
  const platform = searchParams.get("platform") || "all"

  const handlePlatformChange = (value: string) => {
    const params = new URLSearchParams(searchParams)
    params.set("platform", value)
    router.push(`?${params.toString()}`)
  }

  return <Select value={platform} onValueChange={handlePlatformChange} />
}
```

---

## 禁止事项

### TypeScript

```tsx
// ❌ 禁止：使用 any
const data: any = fetchData()
function process(input: any): any { }

// ✅ 正确：明确类型
const data: Message[] = await fetchData()
function process(input: Message): ProcessedMessage { }

// ❌ 禁止：类型断言绕过检查
const message = data as Message  // 除非确实需要

// ✅ 正确：类型守卫
function isMessage(data: unknown): data is Message {
  return typeof data === 'object' && data !== null && 'id' in data
}
```

### 样式

```tsx
// ❌ 禁止：硬编码颜色
<div className="bg-[#ffffff] text-[#333333]">
<div style={{ color: '#ff0000' }}>

// ❌ 禁止：非动态的内联 style
<div style={{ padding: '16px', margin: '8px' }}>

// ❌ 禁止：自定义 CSS 文件（除 globals.css）
import "./custom-styles.css"

// ❌ 禁止：!important
<div className="text-red-500!">
```

### 组件

```tsx
// ❌ 禁止：在 Server Component 使用 hooks
export default function Page() {
  const [state, setState] = useState()  // 错误！
}

// ❌ 禁止：不必要的 "use client"
"use client"
export function StaticCard({ title }: { title: string }) {
  return <div>{title}</div>  // 纯展示，不需要 client
}

// ❌ 禁止：Props drilling 超过 3 层
<A><B><C><D prop={value} /></C></B></A>  // 使用 Context
```

---

## 检查清单

### 前端检查

- [ ] 使用 shadcn/ui 组件，无原生 HTML 交互元素
- [ ] 无硬编码颜色（`#xxx`、`rgb()`、`oklch()`）
- [ ] 样式全部使用 Tailwind class，无 style（动态值除外）
- [ ] 使用 `cn()` 合并 className
- [ ] 图标统一使用 Lucide React
- [ ] 组件类型定义完整，无 `any`
- [ ] 事件处理函数命名 `handle + 动作`
- [ ] 文件命名 kebab-case，组件名 PascalCase
- [ ] 非页面组件使用具名导出
- [ ] 优先 Server Component，必要时才 Client
- [ ] 使用 React 19 新特性（ref prop、use()、useActionState）
- [ ] 无 forwardRef、defaultProps 等废弃 API

### 后端检查

- [ ] 使用 App Router Route Handlers（非 pages/api）
- [ ] params 使用 `await context.params`（Next.js 15+）
- [ ] 所有输入用 zod 验证
- [ ] 响应格式统一 `{ data }` / `{ error }`
- [ ] 使用 ES Modules（非 CommonJS）
- [ ] 使用原生 fetch（非 axios）
- [ ] 使用 crypto.randomUUID()（非 uuid 库）
- [ ] 异步文件操作使用 fs/promises

### 提交前

```bash
# 类型检查
npx tsc --noEmit

# 代码检查
npm run lint

# 构建测试
npm run build
```

### 检查废弃 API

```bash
# 检查 React 废弃 API
grep -rE "forwardRef|defaultProps|PropTypes" --include="*.tsx" app/ components/

# 检查 Next.js 废弃写法
grep -rE "getServerSideProps|getStaticProps|pages/api" --include="*.ts" --include="*.tsx" .

# 检查硬编码颜色
grep -rE "bg-\[#|text-\[#|border-\[#|#[0-9a-fA-F]{3,8}" --include="*.tsx" app/ components/

# 检查 CommonJS
grep -rE "require\(|module\.exports" --include="*.ts" app/ lib/
```

---

## 错误示例集

```tsx
// ❌ 使用原生 HTML 交互元素
<button onClick={handleSubmit}>提交</button>
<input type="text" placeholder="请输入" />
<select><option>选项</option></select>

// ❌ 硬编码颜色
<div className="bg-[#ffffff] text-[#262626]">
<div style={{ backgroundColor: 'white' }}>

// ❌ 非动态内联样式
<div style={{ padding: 16, marginTop: 8 }}>

// ❌ 使用 any
const handleData = (data: any) => { }

// ❌ 混用图标库
import { FaHome } from "react-icons/fa"
import { Home } from "lucide-react"

// ❌ 不必要的 Client Component
"use client"
export function Logo() {
  return <img src="/logo.png" alt="Logo" />  // 纯展示不需要 client
}

// ❌ default export（非页面）
export default function MessageCard() { }

// ❌ 不规范命名
const click = () => { }  // 应该是 handleClick
function messagecard() { }  // 应该是 MessageCard
```

---

## 推荐 VSCode 配置

### 必装扩展

- **Tailwind CSS IntelliSense** - Tailwind 智能提示
- **ESLint** - 代码检查
- **Prettier** - 代码格式化
- **TypeScript** - TS 支持

### settings.json

```json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "tailwindCSS.experimental.classRegex": [
    ["cn\\(([^)]*)\\)", "'([^']*)'"]
  ]
}
```

---

## 版本信息

| 依赖 | 版本 | 说明 |
|------|------|------|
| Next.js | 16.1.0 | App Router + Server Actions |
| React | 19.2.3 | use() / useActionState / ref prop |
| Tailwind CSS | 4.x | CSS 变量 + @theme |
| shadcn/ui | new-york | 组件库风格 |
| lucide-react | 0.562.0 | 图标库 |
| TypeScript | 5.x | 严格模式 |
| Prisma | - | ORM（待添加） |
| zod | - | Schema 验证（待添加） |

---

## 规范理念对照

| 理念 | nexlyn (Ant Design) | moedesk (shadcn/ui) |
|------|---------------------|---------------------|
| **组件统一** | 禁止原生，用 ProComponents | 禁止原生，用 shadcn/ui |
| **颜色规范** | CSS 变量 `var(--ant-*)` | Tailwind `bg-primary` |
| **动态颜色** | `theme.useToken()` | 内联 style + CSS 变量 |
| **布局组件** | `<Flex>` / `<Space>` | Tailwind flex/grid |
| **表单方案** | ProForm + formRef | react-hook-form + zod |
| **废弃 API** | 禁止 antd v4 / Pro 2.x | 禁止 forwardRef / pages/ |
| **检查工具** | grep hideInSearch 等 | grep forwardRef / CommonJS |
| **后端规范** | 无（独立后端） | Route Handlers + Server Actions |

---

## 快速参考

### 新特性速查

| 场景 | 旧写法 | 新写法 |
|------|--------|--------|
| 转发 ref | `forwardRef()` | 直接 `ref` prop |
| 默认值 | `defaultProps` | ES6 默认参数 |
| 数据获取 | `useEffect` + fetch | `use()` + Suspense |
| 表单状态 | 手动 useState | `useActionState` |
| 乐观更新 | 手动实现 | `useOptimistic` |
| API 路由 | `pages/api/*.ts` | `app/api/*/route.ts` |
| 页面数据 | `getServerSideProps` | Server Component |
| 页面元数据 | `next/head` | `metadata` 导出 |
| 深拷贝 | `JSON.parse(JSON.stringify())` | `structuredClone()` |
| 生成 ID | `uuid` 库 | `crypto.randomUUID()` |
| HTTP 请求 | `axios` / `node-fetch` | 原生 `fetch` |
